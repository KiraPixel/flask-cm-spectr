<div class="tab-pane fade show active" id="info" role="tabpanel" aria-labelledby="info-tab">
    <div class="row g-3">
        {% if 'car_info_storage' in g.role %}
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-3">
                <div class="card-header rounded-top-3">
                    <h5 class="mb-0"><i class="bi bi-house me-2"></i> Информация о складе</h5>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>Название склада:</strong> <span id="storage_name" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Тип склада:</strong> <span id="storage_type" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Регион:</strong> <span id="storage_region" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Адрес:</strong> <span id="storage_address" class="text-muted">-</span></p>
                </div>
            </div>
        </div>
        {% endif %}
        {% if 'car_info_model' in g.role %}
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-3">
                <div class="card-header rounded-top-3">
                    <h5 class="mb-0"><i class="bi bi-truck me-2"></i> Модель транспортного средства</h5>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>VIN:</strong> <span id="vin" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Год выпуска:</strong> <span id="manufacture_year" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Тип:</strong> <span id="model_type" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Тип техники:</strong> <span id="machine_type" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Бренд:</strong> <span id="brand" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Модель:</strong> <span id="model" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Тип подъемника:</strong> <span id="lift_type" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Двигатель:</strong> <span id="engine" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Название в 1С:</strong> <span id="model_name" class="text-muted">-</span></p>

                </div>
            </div>
        </div>
        {% endif %}
        {% if 'car_info_rent' in g.role %}
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-3">
                <div class="card-header rounded-top-3">
                    <h5 class="mb-0"><i class="bi bi-person-workspace me-2"></i> Аренда</h5>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>Клиент:</strong> <span id="customer" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Контакт клиента:</strong> <span id="customer_contact" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Менеджер:</strong> <span id="manager" class="text-muted">-</span></p>
                    <p class="mb-1"><strong>Координаты:</strong>
                        <span id="coordinates" class="coords-link" data-coords="-">-</span>
                    </p>
                    <p class="mb-1"><strong>Адрес:</strong> <span id="address" class="text-muted">-</span></p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<script>
console.log('Info script loaded'); // Для отладки

window.addEventListener('carDataLoaded', function() {

    // Функция для безопасного обновления textContent
    function setTextContent(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = value || '-';
        }
    }

    // Информация о складе
    setTextContent('storage_name', window.carData.storage?.name);
    setTextContent('storage_type', window.carData.storage?.type);
    setTextContent('storage_region', window.carData.storage?.region);
    setTextContent('storage_address', window.carData.storage?.address);

    // Информация о модели транспортного средства (если есть)
    setTextContent('model_type', window.carData.transport_model?.type);
    setTextContent('model_name', window.carData.transport_model?.name);
    setTextContent('model', window.carData.transport_model?.model);
    setTextContent('machine_type', window.carData.transport_model?.machine_type);
    setTextContent('brand', window.carData.transport_model?.brand);
    setTextContent('lift_type', window.carData.transport_model?.lift_type);
    setTextContent('engine', window.carData.transport_model?.engine);
    setTextContent('vin', window.carData.transport?.vin);
    setTextContent('manufacture_year', window.carData.transport?.manufacture_year);

    // Информация об аренде
    setTextContent('customer', window.carData.rent?.customer);
    setTextContent('customer_contact', window.carData.rent?.customer_contact);
    setTextContent('manager', window.carData.rent?.manager);

    // Установка координат и добавление data-coords
    const coordsElement = document.getElementById('coordinates');
    if (coordsElement) {
        const coords = window.carData.rent?.x && window.carData.rent?.y
            ? `${window.carData.rent.x}, ${window.carData.rent.y}`
            : '-';
        coordsElement.textContent = coords;
        coordsElement.setAttribute('data-coords', coords);
        coordsElement.style.cursor = coords === '-' ? 'default' : 'pointer';
        coordsElement.style.color = coords === '-' ? 'inherit' : 'var(--bs-primary)';

        // Добавление обработчика клика на координаты
        coordsElement.addEventListener('click', function() {
            const coordsStr = this.getAttribute('data-coords');
            if (coordsStr && coordsStr !== '-') {
                const [lat, lon] = coordsStr.split(',').map(Number);
                if (!isNaN(lat) && !isNaN(lon) && window.MapController) {
                    window.MapController.setCenter([lat, lon], 15); // Зум до уровня 15
                } else {
                    console.error('Ошибка: Некорректные координаты или MapController не определен');
                }
            }
        });
    } else {
        console.error('Ошибка: Элемент с id "coordinates" не найден в DOM');
    }

    setTextContent('address', window.carData.rent?.address);
});
</script>


<style>
    .coords-link:hover {
        text-decoration: underline;
    }
</style>